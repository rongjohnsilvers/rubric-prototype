<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rubric Grading Prototype</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Sans 3', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f5f5;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 56px;
            background-color: #fff;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 16px 0;
        }

        .sidebar-icon {
            width: 32px;
            height: 32px;
            margin: 12px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 4px;
            color: #666;
        }

        .sidebar-icon:hover {
            background-color: #f0f0f0;
        }

        .sidebar-icon.active {
            color: #ff6600;
            border-left: 3px solid #ff6600;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 40px 60px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        h1 {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 32px;
            color: #333;
        }

        /* Assignments Table */
        .assignments-table {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header, .table-row {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1.5fr 1.5fr 200px 50px;
            padding: 16px 24px;
            align-items: center;
            gap: 16px;
        }

        .table-header {
            background-color: #fafafa;
            font-weight: 600;
            font-size: 14px;
            color: #666;
            border-bottom: 1px solid #e0e0e0;
        }

        .table-row {
            border-bottom: 1px solid #f0f0f0;
        }

        .table-row:hover {
            background-color: #fafafa;
        }

        .review-btn {
            background-color: #ff6600;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .review-btn:hover {
            background-color: #e55a00;
        }

        .menu-btn {
            cursor: pointer;
            font-size: 20px;
            color: #666;
        }

        /* Student List */
        .student-list {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .student-header {
            padding: 24px;
            border-bottom: 1px solid #e0e0e0;
        }

        .student-header h2 {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .student-stats {
            font-size: 14px;
            color: #666;
        }

        .student-table-header {
            display: grid;
            grid-template-columns: 1.5fr 1.5fr 1.2fr 1.2fr 0.8fr 150px;
            padding: 16px 24px;
            align-items: center;
            gap: 16px;
            background-color: #fafafa;
            font-weight: 600;
            font-size: 14px;
            color: #666;
            border-bottom: 1px solid #e0e0e0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .sortable {
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: color 0.2s;
        }

        .sortable:hover {
            color: #ff6600;
        }

        .sort-indicator {
            font-size: 10px;
            color: #999;
            min-width: 12px;
        }

        .sort-indicator.active {
            color: #ff6600;
        }

        .actions-header {
            text-align: center;
        }

        .student-item {
            display: grid;
            grid-template-columns: 1.5fr 1.5fr 1.2fr 1.2fr 0.8fr 150px;
            padding: 20px 24px;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
            cursor: pointer;
            gap: 16px;
        }

        .student-item:hover {
            background-color: #fafafa;
        }

        .student-score {
            font-weight: 600;
            color: #333;
        }

        .student-score.graded {
            color: #388e3c;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .hide-tablet {
                display: none;
            }

            .student-table-header {
                grid-template-columns: 1.5fr 1.5fr 1.2fr 150px;
            }

            .student-item {
                grid-template-columns: 1.5fr 1.5fr 1.2fr 150px;
            }
        }

        @media (max-width: 768px) {
            .hide-mobile {
                display: none;
            }

            .student-table-header {
                grid-template-columns: 1fr 1fr 120px;
                font-size: 13px;
                padding: 12px 16px;
            }

            .student-item {
                grid-template-columns: 1fr 1fr 120px;
                padding: 16px;
            }

            .main-content {
                padding: 20px 16px;
            }

            h1 {
                font-size: 24px;
            }

            .status-badge {
                font-size: 11px;
                padding: 3px 8px;
            }

            .grade-btn, .continue-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .student-table-header {
                grid-template-columns: 1fr 1fr 100px;
                padding: 10px 12px;
                gap: 8px;
            }

            .student-item {
                grid-template-columns: 1fr 1fr 100px;
                padding: 12px;
                gap: 8px;
            }

            .grade-btn, .continue-btn {
                padding: 6px 10px;
                font-size: 11px;
                width: 100%;
            }
        }

        .student-name {
            font-weight: 500;
            color: #333;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-submitted {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .status-graded {
            background-color: #e8f5e9;
            color: #388e3c;
        }

        .status-pending {
            background-color: #fff3e0;
            color: #f57c00;
        }

        .grade-btn {
            background-color: #ff6600;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
        }

        .continue-btn {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
        }

        /* Grading Interface */
        .grading-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            align-items: start;
        }

        .grading-panel {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        .grading-panel.sticky {
            position: sticky;
            top: 24px;
            align-self: start;
        }

        .panel-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e0e0e0;
            background-color: #fafafa;
        }

        .panel-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .panel-subheader {
            font-size: 13px;
            color: #666;
        }

        .panel-content {
            padding: 24px;
        }

        /* Student Work */
        .question-block {
            margin-bottom: 32px;
        }

        .question-label {
            font-weight: 600;
            color: #666;
            font-size: 13px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .question-text {
            font-size: 15px;
            color: #333;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .student-response {
            background-color: #f9f9f9;
            padding: 16px;
            border-radius: 6px;
            border-left: 3px solid #1976d2;
            font-size: 14px;
            line-height: 1.6;
            color: #444;
        }

        /* Rubric */
        .rubric-item {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid #f0f0f0;
        }

        .rubric-item:last-child {
            border-bottom: none;
        }

        .rubric-criterion {
            font-weight: 600;
            font-size: 14px;
            color: #333;
            margin-bottom: 12px;
        }

        .rubric-points {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .point-option {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
            background-color: #fff;
        }

        .point-option:hover {
            border-color: #ff6600;
        }

        .point-option.selected {
            background-color: #ff6600;
            border-color: #ff6600;
            color: white;
        }

        .feedback-textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            margin-top: 8px;
            overflow-y: hidden;
        }

        .feedback-textarea:focus {
            outline: none;
            border-color: #ff6600;
        }

        .ai-assist-btn {
            background-color: #9c27b0;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            margin-top: 8px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .ai-assist-btn:hover {
            background-color: #7b1fa2;
        }

        /* Action Bar */
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-top: 1px solid #e0e0e0;
            background-color: #fafafa;
        }

        .score-display {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
        }

        .btn-secondary {
            background-color: #fff;
            color: #666;
            border: 1px solid #e0e0e0;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
        }

        .btn-secondary:hover {
            background-color: #f5f5f5;
        }

        .btn-primary {
            background-color: #4caf50;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
        }

        .btn-primary:hover {
            background-color: #45a049;
        }

        .btn-primary.resubmit {
            background-color: #fff;
            color: #4caf50;
            border: 2px solid #4caf50;
        }

        .btn-primary.resubmit:hover {
            background-color: #f1f8f4;
        }

        .student-nav {
            display: flex;
            gap: 8px;
        }

        .nav-btn {
            background-color: #fff;
            color: #666;
            border: 1px solid #e0e0e0;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-btn:hover {
            background-color: #f5f5f5;
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .back-link {
            color: #1976d2;
            text-decoration: none;
            font-size: 14px;
            margin-bottom: 16px;
            display: inline-block;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .overall-feedback {
            margin-top: 24px;
        }

        .overall-feedback h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #333;
        }

        .saved-indicator {
            display: none;
            color: #4caf50;
            font-size: 13px;
            font-weight: 500;
            animation: fadeIn 0.3s;
        }

        .saved-indicator.show {
            display: inline-block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .success-message {
            display: none;
            background-color: #e8f5e9;
            color: #2e7d32;
            padding: 16px 24px;
            border-radius: 6px;
            margin-bottom: 24px;
            border-left: 4px solid #4caf50;
        }

        .success-message.show {
            display: block;
        }

        .lesson-objectives {
            background-color: #f9f9f9;
            padding: 16px;
            border-radius: 6px;
            border-left: 3px solid #1976d2;
            margin-bottom: 20px;
        }

        .lesson-objectives ul {
            list-style: none;
            padding: 0;
            margin: 8px 0 0 0;
        }

        .lesson-objectives li {
            padding: 6px 0;
            font-size: 14px;
            line-height: 1.5;
        }

        .rubric-points {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .point-option {
            text-align: center;
            flex: 0 0 auto;
            min-width: fit-content;
            white-space: normal;
            line-height: 1.3;
            padding: 10px 14px;
        }

        .ai-suggested-badge {
            display: none;
            background-color: #f3e5f5;
            color: #9c27b0;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
            vertical-align: middle;
        }

        .ai-suggested-badge.show {
            display: inline-block;
        }

        .rubric-criterion-header {
            display: flex;
            align-items: center;
            margin-top: 20px;
        }

        .submitted-message {
            display: none;
            align-items: center;
            gap: 8px;
            color: #2e7d32;
            font-weight: 600;
            font-size: 14px;
        }

        .submitted-message.show {
            display: flex;
        }

        /* Evidence Highlighting */
        .highlight-positive {
            background-color: #d4edda;
            border-bottom: 2px solid #28a745;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .highlight-concern {
            background-color: #fff3cd;
            border-bottom: 2px solid #ffc107;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .highlight-missing {
            background-color: #f8d7da;
            border-bottom: 2px solid #dc3545;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .evidence-legend {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
            padding: 12px;
            background-color: #f9f9f9;
            border-radius: 6px;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-color {
            width: 20px;
            height: 12px;
            border-radius: 3px;
        }

        /* Feedback Snippets */
        .feedback-snippets {
            margin-bottom: 20px;
        }

        .feedback-snippets h5 {
            font-size: 13px;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .snippet-category {
            margin-bottom: 12px;
        }

        .snippet-category-title {
            font-size: 11px;
            font-weight: 600;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .snippet-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .snippet-chip {
            background-color: #f0f0f0;
            border: 1px solid #e0e0e0;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            color: #555;
        }

        .snippet-chip:hover {
            background-color: #e3f2fd;
            border-color: #1976d2;
            color: #1976d2;
        }

        .snippet-chip:active {
            transform: scale(0.95);
        }

        .snippet-chip.selected {
            background-color: #ff6600;
            border-color: #ff6600;
            color: white;
        }

        .snippet-chip.selected:hover {
            background-color: #e65c00;
            border-color: #e65c00;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-icon active">üìö</div>
            <div class="sidebar-icon">üîç</div>
            <div class="sidebar-icon">üìã</div>
            <div class="sidebar-icon">üí¨</div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Page 1: Assignments List -->
            <div id="page-assignments" class="page active">
                <h1>Assignments</h1>
                <div class="assignments-table">
                    <div class="table-header">
                        <div>Assignment Name</div>
                        <div>Assigned to</div>
                        <div>Completed by</div>
                        <div>Due Date</div>
                        <div></div>
                        <div></div>
                    </div>
                    <div class="table-row">
                        <div>9.1.3. Our Digital Habits</div>
                        <div>Advisory 1</div>
                        <div>18/20 students</div>
                        <div>January 30, 2025</div>
                        <div>
                            <button class="review-btn" onclick="goToPage('page-students')">Review Responses</button>
                        </div>
                        <div class="menu-btn">‚ãÆ</div>
                    </div>
                </div>
            </div>

            <!-- Page 2: Student List -->
            <div id="page-students" class="page">
                <a href="#" class="back-link" onclick="goToPage('page-assignments'); return false;">‚Üê Back to Assignments</a>
                <h1>9.1.3. Our Digital Habits</h1>

                <div id="success-message" class="success-message">
                    ‚úì Rubric submitted successfully for <span id="graded-student-name"></span>
                </div>

                <div class="student-list">
                    <div class="student-header">
                        <h2>Student Responses</h2>
                        <div class="student-stats">18 of 20 students completed ‚Ä¢ 5 graded ‚Ä¢ 13 pending</div>
                    </div>

                    <div class="table-header student-table-header">
                        <div class="sortable" onclick="sortTable('lastName')">
                            Last Name <span class="sort-indicator">‚ñº</span>
                        </div>
                        <div class="sortable" onclick="sortTable('firstName')">
                            First Name <span class="sort-indicator"></span>
                        </div>
                        <div class="sortable hide-mobile" onclick="sortTable('submittedDate')">
                            Submitted <span class="sort-indicator"></span>
                        </div>
                        <div class="sortable hide-tablet" onclick="sortTable('status')">
                            Status <span class="sort-indicator"></span>
                        </div>
                        <div class="sortable hide-tablet" onclick="sortTable('score')">
                            Score <span class="sort-indicator"></span>
                        </div>
                        <div class="actions-header">Actions</div>
                    </div>

                    <div id="student-table-body">
                        <!-- Student rows will be dynamically generated here -->
                    </div>
                </div>
            </div>

            <!-- Page 3: Grading Interface -->
            <div id="page-grading" class="page">
                <a href="#" class="back-link" onclick="goToPage('page-students'); return false;">‚Üê Back to Student List</a>
                <h1 id="grading-student-name">Grading: Emma Thompson</h1>

                <div class="grading-layout">
                    <!-- Left Panel: Student Work -->
                    <div class="grading-panel">
                        <div class="panel-header">
                            <h3>Student Submission</h3>
                            <div class="panel-subheader">Submitted on January 28, 2025</div>
                        </div>
                        <div class="panel-content">
                            <div class="question-block">
                                <div class="question-label">Section 1: Digital Behaviors</div>
                                <div class="question-text">Reflect on the digital habit statements below. Mark one or two that feel most true for you, then write them in your own words.</div>
                                <div class="student-response">
                                    <strong>Student's selections:</strong><br>
                                    ‚úì I look at my phone or other digital devices when I get a notification, even when I'm talking to someone else in person.<br>
                                    ‚úì When I go out somewhere, hang out with someone, or am making something, I think about how I might post about it.<br>
                                    ‚úì I check my phone as soon as I wake up, whenever I'm waiting for something, or when I'm bored.<br><br>

                                    <strong>Not selected:</strong><br>
                                    ‚óã I spend more time than I'd like to scrolling through social media or other apps, and I have a hard time controlling it.<br>
                                    ‚óã I feel anxious when I don't have my phone with me or when the battery is low.<br><br>

                                    <strong>In their own words:</strong><br>
                                    "I constantly check my phone for notifications even during conversations, which makes me less present. I also find myself thinking about posting on social media whenever something interesting happens, and I automatically reach for my phone whenever there's a quiet moment."
                                </div>
                            </div>

                            <div class="question-block">
                                <div class="question-label">Section 2: Core Needs</div>
                                <div class="question-text">Which of these core needs feels most connected to your habit? Mark one or two.</div>
                                <div class="student-response">
                                    <strong>Student's selections:</strong><br>
                                    ‚úì Connection: "I want to feel connection with others."<br>
                                    ‚úì Acceptance: "I want to feel accepted."<br><br>

                                    <strong>Not selected:</strong><br>
                                    ‚óã Curiosity: "I want to explore and learn."<br>
                                    ‚óã Control: "I want to feel in control."<br>
                                    ‚óã Stimulation: "I want to feel entertained or excited."<br><br>

                                    <strong>Their reflection:</strong><br>
                                    "My phone habits are driven by wanting to stay connected with my friends and feeling like I need to respond quickly to messages. I also worry about missing out on social interactions online, and posting content makes me feel validated when people engage with it."
                                </div>
                            </div>

                            <div class="question-block">
                                <div class="question-label">Section 3: Future Changes</div>
                                <div class="question-text">Write down 1-3 digital habits you want to try to change in the future.</div>
                                <div class="student-response">
                                    1. <strong>Be more present during in-person conversations</strong> - Put my phone face-down or in my pocket when hanging out with friends and family, and resist checking notifications until the conversation is over.<br><br>

                                    2. <strong>Reduce mindless scrolling</strong> - Set app time limits on social media (30 minutes per day) and use that time more intentionally instead of scrolling when bored.<br><br>

                                    3. <strong>Create phone-free morning and evening routines</strong> - Don't check my phone for the first 30 minutes after waking up, and put it away 1 hour before bed to improve my sleep and start/end my day more mindfully.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Rubric -->
                    <div class="grading-panel sticky">
                        <div class="panel-header">
                            <h3>Grading Rubric</h3>
                            <div class="panel-subheader">Score: <span id="total-score">Not Yet Scored</span></div>
                        </div>
                        <div class="panel-content">
                            <div class="rubric-item">
                                <div class="rubric-criterion">Lesson Objectives</div>
                                <div class="question-text" style="font-size: 13px; color: #666; margin-bottom: 16px;">
                                    ‚Ä¢ Students will be able to <strong>interpret the "Why" behind their digital habits</strong><br>
                                    ‚Ä¢ Students will be able to <strong>critique how their digital habits impact their lives</strong>
                                </div>

                                <div class="rubric-criterion-header">
                                    <div class="rubric-criterion">Select Score</div>
                                    <span class="ai-suggested-badge" id="ai-suggested-badge">‚ú® AI Suggested</span>
                                </div>
                                <div class="rubric-points">
                                    <div class="point-option" data-points="5" onclick="selectPoints(this)">5 - Excellent</div>
                                    <div class="point-option" data-points="4" onclick="selectPoints(this)">4 - Good</div>
                                    <div class="point-option" data-points="3" onclick="selectPoints(this)">3 - Satisfactory</div>
                                    <div class="point-option" data-points="2" onclick="selectPoints(this)">2 - Limited</div>
                                    <div class="point-option" data-points="1" onclick="selectPoints(this)">1 - Insufficient</div>
                                    <div class="point-option" data-points="0" onclick="selectPoints(this)">0 - No Evidence</div>
                                </div>

                                <div id="score-description" style="background-color: #f0f7ff; padding: 16px; border-radius: 6px; margin-top: 16px; font-size: 13px; line-height: 1.6; display: none;">
                                    <strong id="score-title"></strong><br>
                                    <span id="score-text"></span>
                                </div>
                            </div>

                            <div class="overall-feedback">
                                <div class="feedback-snippets">
                                    <h5>‚ú® Quick Feedback</h5>

                                    <div class="snippet-category">
                                        <div class="snippet-category-title">Strengths</div>
                                        <div class="snippet-chips" id="snippets-strengths"></div>
                                    </div>

                                    <div class="snippet-category">
                                        <div class="snippet-category-title">Areas for Improvement</div>
                                        <div class="snippet-chips" id="snippets-improvements"></div>
                                    </div>

                                    <div class="snippet-category">
                                        <div class="snippet-category-title">Suggestions</div>
                                        <div class="snippet-chips" id="snippets-suggestions"></div>
                                    </div>
                                </div>

                                <h4>Comments</h4>
                                <textarea id="feedback-textarea" class="feedback-textarea" placeholder=""></textarea>
                            </div>
                        </div>
                        <div class="action-bar">
                            <div>
                                <div class="score-display">Score: <span id="current-score">‚Äî</span> / 5</div>
                                <span class="saved-indicator" id="saved-indicator">‚úì Progress saved</span>
                            </div>
                            <div class="action-buttons">
                                <button class="btn-secondary" onclick="saveProgress()">Save & Exit</button>
                                <div class="student-nav">
                                    <button class="nav-btn" onclick="previousStudent()">‚Üê Previous</button>
                                    <button class="nav-btn" onclick="nextStudent()">Next ‚Üí</button>
                                </div>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div class="submitted-message" id="submitted-message">
                                        <span>‚úì Submitted successfully</span>
                                    </div>
                                    <button class="btn-primary" id="submit-btn" onclick="submitRubric()">Submit Grade</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPage = 'page-assignments';
        let currentStudentIndex = 0;
        let currentScore = null;
        let currentSort = { column: 'lastName', ascending: true };
        let isSubmitted = false;

        const students = [
            { firstName: 'Emma', lastName: 'Thompson', status: 'submitted', submittedDate: '2025-01-28', score: null },
            { firstName: 'Marcus', lastName: 'Chen', status: 'submitted', submittedDate: '2025-01-29', score: null },
            { firstName: 'Sophia', lastName: 'Rodriguez', status: 'graded', submittedDate: '2025-01-27', score: 5 },
            { firstName: 'Aiden', lastName: 'Kumar', status: 'submitted', submittedDate: '2025-01-29', score: null },
            { firstName: 'Olivia', lastName: 'Washington', status: 'inprogress', submittedDate: null, score: null },
            { firstName: 'Lucas', lastName: 'Martinez', status: 'submitted', submittedDate: '2025-01-30', score: null },
            { firstName: 'Isabella', lastName: 'Anderson', status: 'graded', submittedDate: '2025-01-28', score: 4 },
            { firstName: 'Ethan', lastName: 'Brown', status: 'submitted', submittedDate: '2025-01-29', score: null },
            { firstName: 'Ava', lastName: 'Davis', status: 'graded', submittedDate: '2025-01-27', score: 5 },
            { firstName: 'Noah', lastName: 'Garcia', status: 'submitted', submittedDate: '2025-01-30', score: null },
            { firstName: 'Mia', lastName: 'Johnson', status: 'graded', submittedDate: '2025-01-28', score: 3 },
            { firstName: 'Liam', lastName: 'Lee', status: 'submitted', submittedDate: '2025-01-29', score: null }
        ];

        const studentSubmissions = {
            0: { // Emma Thompson
                behaviors: {
                    selected: [0, 1, 2],
                    ownWords: "I constantly check my phone for notifications even during conversations, which makes me less present. I also find myself thinking about posting on social media whenever something interesting happens, and I automatically reach for my phone whenever there's a quiet moment."
                },
                coreNeeds: {
                    selected: [0, 1],
                    reflection: "My phone habits are driven by wanting to stay connected with my friends and feeling like I need to respond quickly to messages. I also worry about missing out on social interactions online, and posting content makes me feel validated when people engage with it."
                },
                changes: [
                    "Be more present during in-person conversations - Put my phone face-down or in my pocket when hanging out with friends and family, and resist checking notifications until the conversation is over.",
                    "Reduce mindless scrolling - Set app time limits on social media (30 minutes per day) and use that time more intentionally instead of scrolling when bored.",
                    "Create phone-free morning and evening routines - Don't check my phone for the first 30 minutes after waking up, and put it away 1 hour before bed to improve my sleep and start/end my day more mindfully."
                ],
                suggestedScore: 4,
                aiFeedback: "Excellent work connecting your digital habits to your core needs for connection and acceptance. Your self-awareness is strong, especially in recognizing how notifications pull you away from in-person conversations.\n\nYour proposed changes are specific and realistic - the phone-free morning/evening routine and setting app time limits show thoughtful planning. Consider tracking your progress for one week and reflecting on what challenges you encounter.\n\nOne area to strengthen: You could explore alternative ways to meet your needs for connection and acceptance that don't rely on constant digital checking. What offline activities give you similar feelings?"
            },
            1: { // Marcus Chen
                behaviors: {
                    selected: [3, 4],
                    ownWords: "I find it really hard to put my phone down once I start scrolling through TikTok or Instagram. Sometimes I look up and realize an hour has passed. I also get anxious when my phone battery is low because I feel disconnected from everything happening online."
                },
                coreNeeds: {
                    selected: [2, 4],
                    reflection: "I think I use my phone a lot because I'm curious about what's happening in the world and with people I follow. It's also really stimulating and entertaining, especially when I'm bored in class or at home. Regular life feels slow compared to the constant stream of content online."
                },
                changes: [
                    "Delete social media apps from my phone on school nights - I can still use them on my computer, but making them less accessible will help me break the automatic scrolling habit.",
                    "Find other ways to entertain myself - Pick up hobbies like drawing, basketball, or reading that give me the stimulation I'm looking for without screens."
                ],
                suggestedScore: 4,
                aiFeedback: "Strong reflection on how curiosity and stimulation drive your phone habits. You've identified a clear pattern of time slipping away during scrolling sessions, which shows good self-awareness.\n\nYour strategy to delete apps on school nights is practical and shows you understand your triggers. Finding alternative hobbies is excellent - consider starting with just one activity this week.\n\nTo strengthen: Be more specific about when you'll do these alternative activities. Instead of 'when bored,' try 'right after school for 30 minutes' to build a consistent habit."
            },
            2: { // Sophia Rodriguez
                behaviors: {
                    selected: [0, 2, 3],
                    ownWords: "I'm always checking my phone - when notifications come in, when I wake up, when I'm waiting in line. I know I spend way too much time on social media but it's really hard to stop once I start scrolling. It's become automatic."
                },
                coreNeeds: {
                    selected: [0, 1, 4],
                    reflection: "My digital habits are mostly about staying connected with friends and not missing out on what everyone's doing. I also feel more accepted when people like my posts or comment on my stories. And honestly, scrolling is just entertaining when there's nothing else to do - it's an easy way to fill time."
                },
                changes: [
                    "Turn off all non-essential notifications - Only keep texts from family and close friends so I'm not constantly pulled to check my phone.",
                    "Set a daily screen time goal of 2 hours for social media and check my progress each night.",
                    "Leave my phone in another room when doing homework or spending time with family so I'm fully present and not tempted to check it constantly."
                ],
                suggestedScore: 5,
                aiFeedback: "Outstanding work! You've demonstrated deep understanding of both the 'why' behind your digital habits and their impact on your life. Your connection of phone use to multiple core needs (connection, acceptance, stimulation) shows sophisticated self-awareness.\n\nYour three proposed changes are specific, actionable, and address different aspects of the problem. The notification strategy tackles interruptions, screen time goals add accountability, and physical separation ensures focus.\n\nYou've fully met both lesson objectives with clear explanations in your own words. Well done!"
            },
            3: { // Aiden Kumar
                behaviors: {
                    selected: [1, 2],
                    ownWords: "Whenever something interesting happens, my first thought is about posting it. Like if I'm at a concert or trying a new restaurant, I'm thinking about what picture to take or what caption to write. I also check my phone constantly throughout the day, especially when I'm bored or waiting."
                },
                coreNeeds: {
                    selected: [1, 2],
                    reflection: "I want people to see the cool stuff I'm doing and think well of me. When I post something and people engage with it, I feel validated. I'm also just naturally curious about what's happening in everyone else's lives and what's trending."
                },
                changes: [
                    "Try having one 'phone-free' experience per week - Go somewhere or do something without posting about it, just enjoy it in the moment.",
                    "Limit checking social media to specific times - Maybe three times a day instead of constantly throughout the day."
                ],
                suggestedScore: 3,
                aiFeedback: "Good start identifying how your digital habits relate to acceptance and curiosity. You've recognized the pattern of performing experiences for social media rather than just living them.\n\nYour changes show awareness, but they could be more specific. What does 'phone-free experience' mean exactly? Which three times of day will you check social media?\n\nTo improve: Add more detail about how these habits impact your life. Do they affect your relationships? Your ability to focus? Your mood? Dig deeper into the critique portion of the assignment."
            },
            4: { // Olivia Washington (in progress - incomplete)
                behaviors: {
                    selected: [2],
                    ownWords: "I check my phone as soon as I wake up to see what I missed overnight."
                },
                coreNeeds: {
                    selected: [0],
                    reflection: "I want to stay connected with my friends."
                },
                changes: [
                    "Try not to use my phone before school."
                ],
                suggestedScore: 2,
                aiFeedback: "You've started to explore your digital habits, but this submission needs more development to meet the lesson objectives.\n\nWhat's missing:\n‚Ä¢ More complete identification of your habits (you selected only 1-2 behaviors)\n‚Ä¢ Deeper explanation in your own words about the 'why' behind these habits\n‚Ä¢ Critical analysis of how these habits impact your daily life\n‚Ä¢ More specific and actionable changes with clear reasoning\n\nPlease expand on each section. Think about: How do these habits affect your relationships, focus, or wellbeing? What specific strategies could you use to change them?"
            },
            5: { // Lucas Martinez
                behaviors: {
                    selected: [0, 3, 4],
                    ownWords: "I have a really hard time controlling my phone use. Even when someone's talking to me, I'll check my phone if I get a notification. I spend way more time scrolling than I mean to, and I feel genuinely anxious when my battery gets low or if I forget my phone at home. It's like I'm addicted."
                },
                coreNeeds: {
                    selected: [0, 3, 4],
                    reflection: "I think I'm trying to stay connected with people, but also I want to feel in control of what's happening. When I don't have my phone, I feel like I'm missing something important. The constant entertainment and stimulation is also hard to resist - real life feels boring in comparison."
                },
                changes: [
                    "Get a basic alarm clock and leave my phone charging in the kitchen overnight - This will stop me from scrolling before bed and first thing in the morning.",
                    "Use the Screen Time feature to block social media apps after 9 PM on school nights.",
                    "Practice being without my phone for short periods - Start with 1 hour, then build up to longer stretches so I get more comfortable with the feeling."
                ],
                suggestedScore: 5,
                aiFeedback: "Excellent, thoughtful reflection! You've identified a problematic relationship with your phone and connected it clearly to multiple core needs. Using the word 'addicted' shows genuine self-awareness about the severity of the issue.\n\nYour proposed changes are comprehensive and progressive - starting with overnight separation, adding time blocks, and gradually building tolerance for phone-free periods. This shows strategic thinking about behavior change.\n\nYou've fully met both objectives with clear interpretation of the 'why' and strong critique of the impacts. The comparison of 'real life feels boring' is particularly insightful. Outstanding work!"
            },
            6: { // Isabella Anderson
                behaviors: {
                    selected: [1, 2, 3],
                    ownWords: "I'm always thinking about content - what would make a good post or story. When I'm hanging out with friends, part of my brain is thinking about how to capture it. I also scroll a lot, probably more than I should, and I check my phone constantly out of habit."
                },
                coreNeeds: {
                    selected: [1, 4],
                    reflection: "Social media makes me feel accepted when people engage with my content. I put effort into my posts because I want people to think I'm interesting and have a cool life. The entertainment factor is also real - scrolling is just easy and always available."
                },
                changes: [
                    "Have phone-free hangouts with friends - Put everyone's phones in a pile and just be present together.",
                    "Reduce posting frequency - Instead of posting daily, try posting only when something genuinely meaningful happens.",
                    "Replace morning scrolling with journaling - Write for 10 minutes instead of scrolling through feeds."
                ],
                suggestedScore: 4,
                aiFeedback: "Strong work identifying how the desire for acceptance drives your content creation mindset. You've shown good awareness of how this affects your real-world experiences with friends.\n\nYour proposed changes are creative and address multiple aspects of the problem. The phone-free hangouts idea is especially good for breaking group habits. Journaling as a replacement activity shows you're thinking about alternatives.\n\nOne area to develop: How exactly do these habits impact your life? You mention them but could dig deeper into the consequences - do they affect your relationships, mental health, or ability to enjoy moments?"
            },
            7: { // Ethan Brown
                behaviors: {
                    selected: [2, 3],
                    ownWords: "I check my phone all the time - when I wake up, when I'm bored, when I'm waiting for anything. I also spend way too long on YouTube and gaming apps, and it's hard to stop once I start."
                },
                coreNeeds: {
                    selected: [2, 4],
                    reflection: "I'm curious about what's new and what's happening online. Videos and games are also just way more stimulating and fun than homework or chores. It's an easy escape."
                },
                changes: [
                    "Set app timers for YouTube and games - Limit to 1 hour total per day.",
                    "Put my phone across the room when doing homework so I'm not tempted to check it."
                ],
                suggestedScore: 3,
                aiFeedback: "Good identification of your habits around seeking stimulation and curiosity through digital content. You recognize the 'escape' aspect, which is an important insight.\n\nYour proposed changes are practical starting points. App timers and physical distance are both proven strategies.\n\nTo strengthen your work: Explain more about the 'why' behind choosing these specific changes. How do your current habits negatively impact your life? What do you hope will be different after making these changes? Add more critical analysis of the consequences."
            },
            8: { // Ava Davis
                behaviors: {
                    selected: [0, 1, 2, 3],
                    ownWords: "I'm constantly on my phone. I interrupt conversations to check notifications, I think about posting whenever I'm doing something, I check it when I wake up and whenever I'm bored, and I definitely scroll way more than I should. It's become automatic and I don't always realize I'm doing it."
                },
                coreNeeds: {
                    selected: [0, 1, 2, 4],
                    reflection: "All of these core needs connect to my phone use. I want connection with friends, I want to feel accepted through likes and comments, I'm curious about what everyone's doing, and scrolling is stimulating and entertaining. My phone meets all these needs at once, which is why it's so hard to put down."
                },
                changes: [
                    "Turn off all notifications except calls and texts from family - This will stop the constant interruptions.",
                    "Delete Instagram and TikTok from my phone for one month - If I really want to check them, I can use my laptop, but this creates friction that will help me break the habit.",
                    "Find offline ways to meet my needs - Join an after-school club for connection, start a creative hobby for stimulation, read news instead of scrolling for curiosity.",
                    "Track my progress - Keep a daily journal noting when I'm tempted to use my phone and how I feel without it."
                ],
                suggestedScore: 5,
                aiFeedback: "Exceptional work! You've demonstrated sophisticated understanding of your digital habits and their underlying motivations. Recognizing that your phone meets multiple core needs simultaneously explains why changing behavior is so challenging.\n\nYour four proposed changes are comprehensive, strategic, and show deep thinking. You're not just reducing phone use, but actively replacing it with offline alternatives that meet the same needs. The tracking component adds accountability and reflection.\n\nYou've exceeded both lesson objectives with thorough interpretation and critique. Your insight that 'it's become automatic and I don't always realize I'm doing it' shows excellent self-awareness. Outstanding!"
            },
            9: { // Noah Garcia
                behaviors: {
                    selected: [2, 4],
                    ownWords: "I check my phone constantly throughout the day, and I feel uncomfortable when my phone isn't with me or the battery is dying. It's like I need to know it's there even if I'm not actively using it."
                },
                coreNeeds: {
                    selected: [0, 3],
                    reflection: "I think it's about staying connected and feeling in control. If I don't have my phone, I feel like I'm out of the loop and can't respond if someone needs me. It gives me a sense of control over my social life."
                },
                changes: [
                    "Practice leaving my phone at home for short trips - Start with quick errands to build comfort with being disconnected.",
                    "Turn off read receipts and 'last seen' on messaging apps - This will reduce the pressure to respond immediately."
                ],
                suggestedScore: 4,
                aiFeedback: "Strong reflection on how your phone use connects to control and connection needs. You've identified the anxiety aspect, which is an important psychological insight about modern phone dependency.\n\nYour proposed changes directly address the root issue - the discomfort with being disconnected. Starting small with short trips and reducing social pressure through app settings shows strategic thinking.\n\nTo enhance: Add one more change that addresses the constant checking behavior throughout the day. Also, elaborate more on how these habits impact your daily life - relationships, focus, stress levels, etc."
            },
            10: { // Mia Johnson
                behaviors: {
                    selected: [1, 2],
                    ownWords: "I think about posting stuff on social media and I check my phone when I'm bored."
                },
                coreNeeds: {
                    selected: [1],
                    reflection: "I guess I want to feel accepted by my friends online."
                },
                changes: [
                    "Use my phone less.",
                    "Maybe post less on social media."
                ],
                suggestedScore: 2,
                aiFeedback: "You've identified some basic patterns, but this submission needs significant development to meet the lesson objectives.\n\nWhat's needed:\n‚Ä¢ Deeper explanation in your own words about WHY you have these habits - go beyond surface-level observations\n‚Ä¢ Critical analysis of HOW these habits impact your life - be specific about consequences\n‚Ä¢ More detailed and actionable changes - 'use phone less' is too vague. What specifically will you do? When? How?\n\nTry to write at least 2-3 sentences for each section. Think critically about your relationship with technology and be honest about its effects on your wellbeing, relationships, and focus."
            },
            11: { // Liam Lee
                behaviors: {
                    selected: [0, 1, 3, 4],
                    ownWords: "My phone completely controls my attention. I'll check it even when someone's talking to me. When I'm out with friends, I'm thinking about how to post about it. I scroll for hours and have trouble stopping. And I get genuinely anxious and uncomfortable when my phone isn't nearby - it's always in my hand or pocket."
                },
                coreNeeds: {
                    selected: [0, 1, 3, 4],
                    reflection: "Looking at all these core needs, I realize my phone has become my main source for all of them. I use it to feel connected to friends, to feel accepted through social validation, to satisfy my curiosity about everything, and for constant entertainment. The problem is I'm not actually meeting these needs in healthy ways - I'm just getting quick hits of satisfaction that fade quickly and leave me wanting more."
                },
                changes: [
                    "Digital sunset at 8 PM every day - Phone goes on the charger in the kitchen and I don't touch it until after breakfast the next morning. This gives me 12+ hours of separation daily.",
                    "Unfollow accounts that make me feel bad about myself - Focus my feed on educational content and close friends only, removing the comparison and validation-seeking.",
                    "Build real-world connections - Instead of texting, call friends or hang out in person. Replace scrolling time with face-to-face interaction.",
                    "Start a 30-day challenge with accountability - Track my screen time daily and share progress with my family so I have external support for making changes."
                ],
                suggestedScore: 5,
                aiFeedback: "Outstanding reflection showing exceptional depth and self-awareness. Your insight that you're 'getting quick hits of satisfaction that fade quickly' demonstrates sophisticated understanding of how digital habits create unsatisfying cycles.\n\nYour four proposed changes are comprehensive and well-reasoned. The digital sunset addresses multiple problems at once, unfollowing toxic accounts shows you're thinking about quality of use (not just quantity), building real-world connections tackles root needs, and accountability mechanisms increase your chances of success.\n\nYou've exceeded both lesson objectives. This is exactly the kind of critical thinking and honest self-reflection we're looking for. Excellent work!"
            }
        };

        const allBehaviors = [
            "I look at my phone or other digital devices when I get a notification, even when I'm talking to someone else in person.",
            "When I go out somewhere, hang out with someone, or am making something, I think about how I might post about it.",
            "I check my phone as soon as I wake up, whenever I'm waiting for something, or when I'm bored.",
            "I spend more time than I'd like to scrolling through social media or other apps, and I have a hard time controlling it.",
            "I feel anxious when I don't have my phone with me or when the battery is low."
        ];

        const allCoreNeeds = [
            "Connection: \"I want to feel connection with others.\"",
            "Acceptance: \"I want to feel accepted.\"",
            "Curiosity: \"I want to explore and learn.\"",
            "Control: \"I want to feel in control.\"",
            "Stimulation: \"I want to feel entertained or excited.\""
        ];

        const feedbackSnippets = {
            strengths: [
                "Strong self-awareness shown",
                "Excellent connection to core needs",
                "Specific and actionable changes",
                "Thoughtful critical analysis",
                "Clear explanation in own words",
                "Deep understanding demonstrated"
            ],
            improvements: [
                "Add more specific details",
                "Explain the 'why' more deeply",
                "Include concrete examples",
                "Describe the impact on daily life",
                "Make changes more actionable",
                "Expand your reflection"
            ],
            suggestions: [
                "Consider tracking your progress",
                "Start with one small change",
                "Identify specific triggers",
                "Think about offline alternatives",
                "Reflect on how this affects relationships",
                "Set measurable goals"
            ]
        };

        const scoreDescriptions = {
            5: {
                title: '5 ‚Äì Excellent',
                text: 'Fully meets the lesson objectives. The response is accurate, complete, and clearly explained in the student\'s own words.'
            },
            4: {
                title: '4 ‚Äì Good',
                text: 'Mostly meets the lesson objectives with minor gaps or slight lack of clarity.'
            },
            3: {
                title: '3 ‚Äì Satisfactory',
                text: 'Partially meets the lesson objectives. Understanding or explanation is incomplete or somewhat unclear.'
            },
            2: {
                title: '2 ‚Äì Limited',
                text: 'Minimally meets the lesson objectives. Significant gaps in understanding and/or unclear explanation.'
            },
            1: {
                title: '1 ‚Äì Insufficient',
                text: 'Does not meaningfully meet the lesson objectives. Explanation is very unclear or largely incomplete.'
            },
            0: {
                title: '0 ‚Äì No Evidence',
                text: 'Response is missing, off-topic, or shows no evidence of meeting the lesson objectives.'
            }
        };

        function goToPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            currentPage = pageId;

            // Render student table when navigating to students page
            if (pageId === 'page-students') {
                renderStudentTable();
            }
        }

        function sortTable(column) {
            // Toggle sort direction if clicking same column
            if (currentSort.column === column) {
                currentSort.ascending = !currentSort.ascending;
            } else {
                currentSort.column = column;
                currentSort.ascending = true;
            }

            renderStudentTable();
        }

        function renderStudentTable() {
            // Sort students
            const sortedStudents = [...students].sort((a, b) => {
                let aVal = a[currentSort.column];
                let bVal = b[currentSort.column];

                // Handle null values
                if (aVal === null) return 1;
                if (bVal === null) return -1;

                // Handle score sorting (numerical)
                if (currentSort.column === 'score') {
                    aVal = aVal || 0;
                    bVal = bVal || 0;
                    return currentSort.ascending ? aVal - bVal : bVal - aVal;
                }

                // String comparison
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }

                if (aVal < bVal) return currentSort.ascending ? -1 : 1;
                if (aVal > bVal) return currentSort.ascending ? 1 : -1;
                return 0;
            });

            // Update sort indicators
            document.querySelectorAll('.sort-indicator').forEach(indicator => {
                indicator.textContent = '';
                indicator.classList.remove('active');
            });

            const headers = document.querySelectorAll('.sortable');
            headers.forEach(header => {
                const onclick = header.getAttribute('onclick');
                if (onclick && onclick.includes(currentSort.column)) {
                    const indicator = header.querySelector('.sort-indicator');
                    indicator.textContent = currentSort.ascending ? '‚ñº' : '‚ñ≤';
                    indicator.classList.add('active');
                }
            });

            // Render table rows
            const tableBody = document.getElementById('student-table-body');
            tableBody.innerHTML = sortedStudents.map((student, index) => {
                const originalIndex = students.indexOf(student);
                const statusClass = student.status === 'graded' ? 'status-graded' :
                                   student.status === 'inprogress' ? 'status-pending' : 'status-submitted';
                const statusText = student.status === 'graded' ? 'Graded' :
                                  student.status === 'inprogress' ? 'In Progress' : 'Submitted';
                const buttonClass = student.status === 'graded' || student.status === 'inprogress' ? 'continue-btn' : 'grade-btn';
                const buttonText = student.status === 'graded' ? 'View' :
                                   student.status === 'inprogress' ? 'Continue' : 'Grade';

                const submittedText = student.submittedDate ?
                    new Date(student.submittedDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) :
                    'Not submitted';

                const scoreDisplay = student.score !== null ?
                    `<span class="student-score graded">${student.score} / 5</span>` :
                    '<span class="student-score">‚Äî</span>';

                return `
                    <div class="student-item" onclick="selectStudent(${originalIndex})">
                        <div class="student-name">${student.lastName}</div>
                        <div class="student-name">${student.firstName}</div>
                        <div class="hide-mobile">${submittedText}</div>
                        <div class="hide-tablet"><span class="status-badge ${statusClass}">${statusText}</span></div>
                        <div class="hide-tablet">${scoreDisplay}</div>
                        <div><button class="${buttonClass}" onclick="event.stopPropagation(); selectStudent(${originalIndex});">${buttonText}</button></div>
                    </div>
                `;
            }).join('');
        }

        function selectStudent(index) {
            currentStudentIndex = index;
            const student = students[index];
            const submission = studentSubmissions[index];

            document.getElementById('grading-student-name').textContent = `Grading: ${student.firstName} ${student.lastName}`;

            // Update student work content
            updateStudentWork(submission);

            // Reset submission state
            isSubmitted = false;
            document.getElementById('submitted-message').classList.remove('show');
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.textContent = 'Submit Grade';
            submitBtn.classList.remove('resubmit');

            // Reset rubric
            currentScore = null;
            document.querySelectorAll('.point-option').forEach(opt => {
                opt.classList.remove('selected', 'ai-suggested');
            });
            document.getElementById('score-description').style.display = 'none';
            document.getElementById('ai-suggested-badge').classList.remove('show');

            // Pre-select AI-suggested score
            const suggestedScore = submission.suggestedScore;
            const suggestedOption = document.querySelector(`.point-option[data-points="${suggestedScore}"]`);
            if (suggestedOption) {
                suggestedOption.classList.add('selected', 'ai-suggested');
                currentScore = suggestedScore;

                // Show AI suggested badge
                document.getElementById('ai-suggested-badge').classList.add('show');

                // Show score description
                const descBox = document.getElementById('score-description');
                const desc = scoreDescriptions[suggestedScore];
                document.getElementById('score-title').textContent = desc.title;
                document.getElementById('score-text').textContent = desc.text;
                descBox.style.display = 'block';
            }

            // Clear feedback textarea
            const feedbackTextarea = document.getElementById('feedback-textarea');
            feedbackTextarea.value = '';
            autoResizeTextarea(feedbackTextarea);

            // Render feedback snippets and clear selections
            renderFeedbackSnippets();

            updateScore();
            goToPage('page-grading');
        }

        function highlightEvidence(text, type = 'ownWords') {
            // Define patterns to highlight for each type
            const patterns = {
                positive: [
                    /\b(self-awareness|recognize|understand|realize|aware)\b/gi,
                    /\b(specific|concrete|clear|detailed|thoughtful)\b/gi,
                    /\b(impact|affect|consequence|result)\b/gi,
                    /\b(I feel|I notice|I've realized|I know)\b/gi,
                    /(less present|constantly|automatically|driven by|validated)/gi
                ],
                concern: [
                    /\b(I guess|maybe|kind of|sort of)\b/gi,
                    /\b(vague|unclear|not sure)\b/gi,
                ],
                missing: [
                    /\b(I don't know|unsure|confusing)\b/gi,
                ]
            };

            let highlighted = text;

            // Apply positive highlights (strong evidence)
            patterns.positive.forEach(pattern => {
                highlighted = highlighted.replace(pattern, match =>
                    `<span class="highlight-positive">${match}</span>`
                );
            });

            // Apply concern highlights (weak language)
            patterns.concern.forEach(pattern => {
                highlighted = highlighted.replace(pattern, match =>
                    `<span class="highlight-concern">${match}</span>`
                );
            });

            return highlighted;
        }

        function updateStudentWork(submission) {
            // Generate behaviors HTML
            const selectedBehaviors = submission.behaviors.selected.map(i =>
                `‚úì ${allBehaviors[i]}`
            ).join('<br>');

            const unselectedBehaviors = allBehaviors
                .map((b, i) => submission.behaviors.selected.includes(i) ? null : `‚óã ${b}`)
                .filter(b => b !== null)
                .join('<br>');

            // Generate core needs HTML
            const selectedNeeds = submission.coreNeeds.selected.map(i =>
                `‚úì ${allCoreNeeds[i]}`
            ).join('<br>');

            const unselectedNeeds = allCoreNeeds
                .map((n, i) => submission.coreNeeds.selected.includes(i) ? null : `‚óã ${n}`)
                .filter(n => n !== null)
                .join('<br>');

            // Generate changes HTML with highlighting
            const changesHTML = submission.changes.map((change, i) => {
                const highlighted = highlightEvidence(change);
                return `${i + 1}. ${highlighted}`;
            }).join('<br><br>');

            // Highlight the student's own words
            const highlightedOwnWords = highlightEvidence(submission.behaviors.ownWords);
            const highlightedReflection = highlightEvidence(submission.coreNeeds.reflection);

            // Update the DOM
            document.querySelector('.panel-content').innerHTML = `
                <div class="evidence-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #d4edda; border-bottom: 2px solid #28a745;"></div>
                        <span>Strong evidence</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #fff3cd; border-bottom: 2px solid #ffc107;"></div>
                        <span>Weak language</span>
                    </div>
                </div>

                <div class="question-block">
                    <div class="question-label">Section 1: Digital Behaviors</div>
                    <div class="question-text">Reflect on the digital habit statements below. Mark one or two that feel most true for you, then write them in your own words.</div>
                    <div class="student-response">
                        <strong>Student's selections:</strong><br>
                        ${selectedBehaviors}<br><br>

                        ${unselectedBehaviors ? `<strong>Not selected:</strong><br>${unselectedBehaviors}<br><br>` : ''}

                        <strong>In their own words:</strong><br>
                        "${highlightedOwnWords}"
                    </div>
                </div>

                <div class="question-block">
                    <div class="question-label">Section 2: Core Needs</div>
                    <div class="question-text">Which of these core needs feels most connected to your habit? Mark one or two.</div>
                    <div class="student-response">
                        <strong>Student's selections:</strong><br>
                        ${selectedNeeds}<br><br>

                        ${unselectedNeeds ? `<strong>Not selected:</strong><br>${unselectedNeeds}<br><br>` : ''}

                        <strong>Their reflection:</strong><br>
                        "${highlightedReflection}"
                    </div>
                </div>

                <div class="question-block">
                    <div class="question-label">Section 3: Future Changes</div>
                    <div class="question-text">Write down 1-3 digital habits you want to try to change in the future.</div>
                    <div class="student-response">
                        ${changesHTML}
                    </div>
                </div>
            `;
        }

        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        function toggleSnippetSelection(element) {
            element.classList.toggle('selected');
        }

        function renderFeedbackSnippets() {
            // Render strengths
            const strengthsContainer = document.getElementById('snippets-strengths');
            strengthsContainer.innerHTML = feedbackSnippets.strengths.map(snippet =>
                `<div class="snippet-chip" onclick="toggleSnippetSelection(this)">${snippet}</div>`
            ).join('');

            // Render improvements
            const improvementsContainer = document.getElementById('snippets-improvements');
            improvementsContainer.innerHTML = feedbackSnippets.improvements.map(snippet =>
                `<div class="snippet-chip" onclick="toggleSnippetSelection(this)">${snippet}</div>`
            ).join('');

            // Render suggestions
            const suggestionsContainer = document.getElementById('snippets-suggestions');
            suggestionsContainer.innerHTML = feedbackSnippets.suggestions.map(snippet =>
                `<div class="snippet-chip" onclick="toggleSnippetSelection(this)">${snippet}</div>`
            ).join('');
        }

        function selectPoints(element) {
            const points = parseInt(element.dataset.points);

            // Remove selection and AI indicator from siblings
            const siblings = element.parentElement.querySelectorAll('.point-option');
            siblings.forEach(sib => {
                sib.classList.remove('selected', 'ai-suggested');
            });

            // Hide AI suggested badge when user manually selects
            document.getElementById('ai-suggested-badge').classList.remove('show');

            // Add selection to clicked element (without AI indicator)
            element.classList.add('selected');

            // Update score
            currentScore = points;
            updateScore();

            // Show score description
            const descBox = document.getElementById('score-description');
            const desc = scoreDescriptions[points];
            document.getElementById('score-title').textContent = desc.title;
            document.getElementById('score-text').textContent = desc.text;
            descBox.style.display = 'block';
        }

        function updateScore() {
            if (currentScore !== null) {
                document.getElementById('current-score').textContent = currentScore;
                document.getElementById('total-score').textContent = `${currentScore} / 5`;
            } else {
                document.getElementById('current-score').textContent = '‚Äî';
                document.getElementById('total-score').textContent = 'Not Yet Scored';
            }
        }

        function saveProgress() {
            const indicator = document.getElementById('saved-indicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
                goToPage('page-students');
            }, 1500);
        }

        function submitRubric() {
            if (currentScore === null) {
                alert('Please select a score before submitting.');
                return;
            }

            const student = students[currentStudentIndex];

            // Update student record with score and status
            students[currentStudentIndex].score = currentScore;
            students[currentStudentIndex].status = 'graded';

            // Update UI to show submitted state
            isSubmitted = true;
            document.getElementById('submitted-message').classList.add('show');
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.textContent = 'Resubmit';
            submitBtn.classList.add('resubmit');

            // Remove AI suggested indicator after submission
            document.querySelectorAll('.point-option').forEach(opt => {
                opt.classList.remove('ai-suggested');
            });
            document.getElementById('ai-suggested-badge').classList.remove('show');
        }

        function previousStudent() {
            if (currentStudentIndex > 0) {
                selectStudent(currentStudentIndex - 1);
            }
        }

        function nextStudent() {
            if (currentStudentIndex < students.length - 1) {
                selectStudent(currentStudentIndex + 1);
            }
        }

        function aiAssist() {
            alert('AI-Assisted Grading:\n\nThis feature would analyze the student\'s submission against the lesson objectives and suggest:\n\n‚Ä¢ Recommended score (0-5) with justification\n‚Ä¢ Evidence from the student\'s work supporting the score\n‚Ä¢ Specific strengths demonstrated\n‚Ä¢ Areas for improvement\n\nFor this submission, it might suggest:\n"Recommended: 4-5 points\n\nThe student demonstrates strong understanding of the \'why\' behind their digital habits by connecting them to core needs (connection & acceptance). They provide thoughtful critique of impacts and propose specific, actionable changes with clear reasoning."');
        }

        function aiAssistOverall() {
            alert('Generate AI Feedback:\n\nThis feature would create personalized, constructive feedback based on:\n\n‚Ä¢ The student\'s responses across all sections\n‚Ä¢ Their score and how they met the objectives\n‚Ä¢ Your teaching voice and feedback style\n‚Ä¢ Actionable next steps for improvement\n\nExample feedback:\n"Excellent work connecting your digital habits to your core needs for connection and acceptance. Your self-awareness is strong, especially in recognizing how notifications pull you away from in-person conversations. Your proposed changes are specific and realistic. Consider tracking your progress for one week and reflecting on what challenges you encounter."');
        }

        // Auto-save simulation
        setInterval(() => {
            // Check if we're on grading page and there is a score
            if (currentPage === 'page-grading' && currentScore !== null) {
                // Simulate auto-save (in real app, this would save to backend)
                console.log('Auto-saving progress...');
            }
        }, 30000); // Every 30 seconds

        // Initialize - sort by last name on page load
        document.addEventListener('DOMContentLoaded', function() {
            renderStudentTable();

            // Add auto-resize to feedback textarea
            const feedbackTextarea = document.getElementById('feedback-textarea');
            if (feedbackTextarea) {
                feedbackTextarea.addEventListener('input', function() {
                    autoResizeTextarea(this);
                });
            }
        });
    </script>
</body>
</html>